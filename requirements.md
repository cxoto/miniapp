# 项目功能需求说明

## 概述
在现有XCTools微信小程序基础上，新增两大核心功能模块，要求与主流产品的UI/UX保持一致。

## 功能模块详细需求

### 1. 阅读功能（微信阅读克隆）
**目标**：实现与微信阅读相同的阅读体验和功能

**核心功能需求**：
- 书架管理：书籍添加、删除、分类
- 阅读界面：
  - 仿微信阅读的翻页动画和排版
  - 字体大小、背景颜色、亮度调节
  - 目录跳转、书签功能
  - 进度保存和同步
- 书籍导入：支持txt、epub格式
- 阅读统计：阅读时长、进度百分比
- 搜索高亮和笔记功能

**UI要求**：
- 书架界面：网格布局，书籍封面显示
- 阅读界面：与微信阅读一致的排版和配色方案
- 设置面板：底部弹出式菜单设计

### 2. 任务管理（Microsoft To Do克隆）
**目标**：实现Microsoft To Do的核心任务管理功能

**核心功能需求**：
- 任务列表管理：创建、编辑、删除列表
- 任务项功能：
  - 添加、完成、星标任务
  - 设置截止日期和提醒
  - 子任务和备注支持
- 智能列表：今天、重要、计划内、任务
- 数据同步：本地存储，支持多设备同步（后期）
- 任务搜索和筛选

**UI要求**：
- 左侧导航栏列表结构
- 右侧任务详情面板
- Microsoft Fluent Design设计语言
- 使用微软品牌的色彩体系

## 技术实现要求

### 架构规划
```
miniprogram/
  pages/
    reader/           # 本地阅读功能
      bookshelf/      # 书架页面
      reading/        # 阅读页面
    online/           # 在线阅读功能（新增）
      bookshelf/      # 在线书架
      search/         # 书籍搜索
      reader/         # 在线阅读器
    todo/            # 任务管理
      lists/         # 列表管理
      detail/        # 任务详情
  utils/
    onlineMockApi.ts  # 在线阅读 Mock API
```

### 数据存储方案
- 使用微信小程序的本地存储进行数据持久化
- 书籍文件存储在本地缓存
- 考虑使用云开发进行多设备同步（可选）

### 开发优先级建议
1. 先实现阅读功能的基础框架
2. 开发任务管理模块
3. 优化各模块的交互细节

## 注意事项
- 保持现有小程序的整体风格一致性
- 确保在多平台（小程序、iOS、Android）上的兼容性
- 注意性能优化，特别是大文件阅读时的内存管理
- 遵循微信小程序的开发规范和限制

---

## 开发进度记录

### 已完成功能 ✅

#### 本地阅读功能（2024-11-23）
- [x] 书架页面 (`pages/reader/bookshelf/`)
  - 书籍网格展示
  - 书籍添加（从文件/聊天记录导入）
  - 书籍删除（批量管理）
  - 分类筛选（全部/在读/已读完）
- [x] 阅读器页面 (`pages/reader/reading/`)
  - TXT 格式解析和显示
  - 自动章节识别
  - 字体大小调节（24-48rpx）
  - 行间距调节（紧凑/适中/宽松）
  - 背景主题（白色/护眼绿/羊皮纸/夜间模式）
  - 翻页模式（滑动/滚动）
  - 目录跳转
  - 书签功能（添加/删除/列表）
  - 进度保存和恢复
- [x] tabBar 入口已添加

#### 在线阅读功能（2024-11-25）
**说明**：全新独立的在线阅读系统，基于后端API，与本地阅读功能完全解耦

- [x] Mock API 工具类 (`utils/onlineMockApi.ts`)
  - 实现所有后端接口的模拟（getUserInfo, getBookshelf, searchBooks等）
  - 包含网络延迟模拟（200-800ms）
  - 丰富的 mock 数据（用户信息、书籍、分组、章节）
  - 支持动态搜索和书架管理

- [x] 在线书架页面 (`pages/online/bookshelf/`)
  - 用户信息展示（头像、用户名、书架统计、阅读时长）
  - 渐变色卡片式 UI 设计
  - 书籍分组标签（全部/科幻小说/历史文学/现代文学/人文社科等）
  - 书架列表展示（封面、作者、进度、最后阅读时间）
  - 下拉刷新功能
  - 空状态引导页面

- [x] 书籍搜索页面 (`pages/online/search/`)
  - 实时搜索输入框
  - 搜索结果列表（书名、作者、简介、字数、来源）
  - 添加到书架功能（一键收藏）
  - 已添加状态显示
  - 空结果提示
  - 热门搜索关键词推荐

- [x] 在线阅读器页面 (`pages/online/reader/`)
  - 章节内容展示（自动生成模拟内容）
  - 上一章/下一章快速导航
  - 侧边栏目录（显示所有章节，当前章节高亮）
  - 阅读设置面板：
    - 字体大小调节（12-24px，A-/A+ 按钮）
    - 4种背景颜色主题（白色/米黄/护眼绿/夜间模式）
  - 章节标题动态更新
  - 滚动到顶部功能
  - **优化体验（2024-11-26）**：
    - 修复目录侧边栏滚动问题（添加 scroll-y、enhanced 属性）
    - 实现点击页面显示/隐藏底部控制面板（类似主流阅读器交互）
    - 控制面板滑入/滑出动画（300ms）
    - 切换章节时自动隐藏控制面板
  - **全面优化（2024-11-30）**：
    - 点击区域优化：
      - 中央34%区域（上下左右各33%边界内）点击显示/隐藏控制面板
      - 四周区域根据翻页模式进行翻页
    - 目录面板改为左侧滑入显示
    - 目录支持顺序/倒序排列切换
    - 点击目录遮罩区域关闭目录
    - 翻页功能优化：
      - 左右翻页模式：左侧点击/右滑上一页，右侧点击/左滑下一页
      - 上下翻页模式：上方点击/下滑上一页，下方点击/上滑下一页
      - 翻页动画效果（微信阅读风格位移+透明度渐变）
      - 100ms 防误触延迟
    - 底部控制面板重新设计（4个按钮）：
      - 目录（☰）：显示章节目录
      - 白天/夜间（☀/☾）：一键切换日夜模式
      - 设置（⚙）：打开阅读设置面板
      - 缓存（↓）：章节缓存（预留功能）
    - 阅读设置面板：
      - 字体大小调节
      - 翻页方向切换（左右翻页/上下翻页）
      - 背景颜色选择（带选中状态指示）
    - 阅读进度本地存储：
      - 自动记录当前章节和页码
      - 页面隐藏时保存进度
      - 再次打开时恢复到上次阅读位置
      - 设置（字体、背景、翻页方向）持久化存储
    - UI 优化：
      - 移除章节标题（导航栏已显示）
      - 移除点击反馈透明遮罩
      - 页码显示移至右下角
      - 禁用内容区域滚动条
      - 内容区域固定高度，适配分页显示

- [x] 首页入口
  - 在 iOS 风格首页添加"在线书城"图标（绿色渐变，地球emoji 🌐）
  - 点击跳转到在线书架页面

**技术特点**：
- ✅ TypeScript 严格类型检查
- ✅ 完整的 Loading/Error/Empty 状态处理
- ✅ 现代化渐变色 UI 设计
- ✅ 流畅的交互动画和反馈
- ✅ Mock 数据支持快速原型验证
- ✅ 修复横向滚动问题（2024-11-26）：所有页面添加 overflow-x: hidden，防止左右滑动出现滚动条

**后续对接后端步骤**：
1. 替换 `onlineMockApi.ts` 中的接口调用为真实 API
2. 添加请求拦截器和错误处理
3. 实现用户登录和身份验证
4. 添加书籍上传和云存储功能

#### 任务管理功能（2024-11-23）
- [x] 任务列表页面 (`pages/todo/lists/`)
  - 智能列表（我的一天/重要/计划内/全部）
  - 自定义列表（创建/重命名/删除）
  - 任务添加/完成/星标
  - 截止日期设置
  - 排序功能
  - Microsoft Fluent Design 风格
- [x] 任务详情页面 (`pages/todo/detail/`)
  - 任务编辑
  - 子任务支持
  - 添加到"我的一天"
  - 截止日期/提醒/重复设置
  - 列表移动
  - 备注功能
- [x] tabBar 入口已添加

### 待完善功能 🔧

#### 本地阅读功能
- [ ] EPUB 格式完整支持
- [ ] 搜索高亮功能
- [ ] 笔记功能
- [ ] 阅读时长统计

#### 在线阅读功能
- [ ] 接入真实后端 API
- [ ] 用户登录和身份验证
- [ ] 书籍详情页面
- [ ] 阅读进度云同步
- [ ] 书签云同步
- [ ] 阅读时长统计
- [ ] 评论和评分功能
- [ ] 个性化推荐
- [ ] 离线缓存下载

#### 任务管理
- [ ] 任务搜索功能
- [ ] 云同步功能
- [ ] 提醒通知功能

### 图标说明 📝
当前使用占位图标，需要替换为正式图标：
- `images/book.png` / `images/book1.png` - 阅读功能图标
- `images/todo.png` / `images/todo1.png` - 任务管理图标