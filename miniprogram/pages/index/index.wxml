<!--index.wxml-->
<view class="ios-home">
  <!-- 状态栏占位 -->
  <view class="status-bar-placeholder"></view>

  <!-- 顶部日期和问候 -->
  <view class="header">
    <view class="header-content">
      <view class="greeting-section">
        <text class="greeting">{{greeting}}</text>
        <text class="date">{{dateStr}}</text>
      </view>
      <!-- 用户头像 -->
      <view class="user-avatar-section" wx:if="{{userProfile}}">
        <image class="user-avatar" src="{{userProfile.avatarUrl}}" mode="aspectFill" />
      </view>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-bar" bindtap="onSearchTap">
    <text class="search-icon">🔍</text>
    <text class="search-placeholder">搜索</text>
  </view>

  <!-- App 网格 -->
  <scroll-view class="app-grid-scroll" scroll-y="{{true}}" show-scrollbar="{{false}}" enhanced="{{true}}">
    <view class="app-grid">
      <!-- 阅读 App -->
      <view class="app-item" bindtap="openApp" data-app="reader">
        <view class="app-icon reader-icon">
          <view class="icon-inner">
            <text class="icon-emoji">📖</text>
          </view>
        </view>
        <text class="app-name">阅读</text>
      </view>

      <!-- 任务 App -->
      <view class="app-item" bindtap="openApp" data-app="todo">
        <view class="app-icon todo-icon">
          <view class="icon-inner">
            <text class="icon-emoji">✅</text>
          </view>
        </view>
        <text class="app-name">任务</text>
      </view>

      <!-- 备忘录 App -->
      <view class="app-item" bindtap="openApp" data-app="notes">
        <view class="app-icon notes-icon">
          <view class="icon-inner">
            <text class="icon-emoji">📝</text>
          </view>
        </view>
        <text class="app-name">备忘录</text>
      </view>

      <!-- 快递 App -->
      <view class="app-item" bindtap="openApp" data-app="express">
        <view class="app-icon express-icon">
          <view class="icon-inner">
            <text class="icon-emoji">📦</text>
          </view>
        </view>
        <text class="app-name">快递</text>
      </view>

      <!-- 设置 App -->
      <view class="app-item" bindtap="openApp" data-app="settings">
        <view class="app-icon settings-icon">
          <view class="icon-inner">
            <text class="icon-emoji">⚙️</text>
          </view>
        </view>
        <text class="app-name">设置</text>
      </view>

      <!-- 更多 App 占位 -->
      <view class="app-item" bindtap="openApp" data-app="more">
        <view class="app-icon more-icon">
          <view class="icon-inner">
            <text class="icon-emoji">➕</text>
          </view>
        </view>
        <text class="app-name">更多</text>
      </view>
    </view>

    <!-- 小组件区域 -->
    <view class="widgets-section">
      <text class="section-title">小组件</text>

      <!-- 阅读进度小组件 -->
      <view class="widget reading-widget" bindtap="openApp" data-app="reader">
        <view class="widget-header">
          <view class="widget-icon">📖</view>
          <text class="widget-title">阅读</text>
        </view>
        <view class="widget-content">
          <text class="widget-stat">{{readingStats.booksCount}}</text>
          <text class="widget-label">本书籍</text>
        </view>
        <view class="widget-footer">
          <text class="widget-hint">继续阅读 →</text>
        </view>
      </view>

      <!-- 任务小组件 -->
      <view class="widget todo-widget" bindtap="openApp" data-app="todo">
        <view class="widget-header">
          <view class="widget-icon">✅</view>
          <text class="widget-title">我的一天</text>
        </view>
        <view class="widget-content">
          <text class="widget-stat">{{todoStats.todayCount}}</text>
          <text class="widget-label">项任务</text>
        </view>
        <view class="widget-footer">
          <text class="widget-hint">查看任务 →</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 用户授权弹窗 -->
  <view class="profile-popup-mask" wx:if="{{showProfilePopup}}" bindtap="closeProfilePopup">
    <view class="profile-popup" catchtap="preventBubble">
      <view class="popup-header">
        <text class="popup-title">完善个人信息</text>
        <text class="popup-subtitle">授权后可使用阅读功能</text>
      </view>

      <view class="popup-content">
        <!-- 头像选择 -->
        <view class="avatar-picker">
          <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image
              wx:if="{{tempAvatarUrl}}"
              class="avatar-preview"
              src="{{tempAvatarUrl}}"
              mode="aspectFill"
            />
            <view wx:else class="avatar-placeholder">
              <text class="placeholder-icon">+</text>
            </view>
            <view class="avatar-edit-icon" wx:if="{{tempAvatarUrl}}">
              <text>+</text>
            </view>
          </button>
          <text class="avatar-hint">点击选择头像</text>
        </view>

        <!-- 昵称输入 -->
        <view class="nickname-input-wrap">
          <input
            class="nickname-input"
            type="nickname"
            placeholder="请输入昵称"
            value="{{tempNickName}}"
            bindinput="onNicknameInput"
          />
        </view>
      </view>

      <view class="popup-footer">
        <button class="cancel-btn" bindtap="closeProfilePopup">取消</button>
        <button class="confirm-btn" bindtap="confirmProfile">确认</button>
      </view>
    </view>
  </view>

</view>
