<view class="notes-container">
  <!-- é¡¶éƒ¨å ä½ï¼Œè®©å†…å®¹ä»èƒ¶å›ŠæŒ‰é’®ä¸‹æ–¹å¼€å§‹ -->
  <view class="top-spacer" style="height: {{contentTop}}px;"></view>

  <!-- æ–‡ä»¶å¤¹åˆ—è¡¨è§†å›¾ -->
  <view class="folder-view" wx:if="{{showFolderList}}">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="nav-bar">
      <view class="nav-left">
        <view class="back-btn" bindtap="goBack">
          <text class="back-icon">ğŸ”™</text>
        </view>
      </view>
      <view class="nav-title">æ–‡ä»¶å¤¹</view>
      <view class="nav-right">
        <view class="edit-btn" bindtap="showNewFolderModal">
          <text>æ–°å»º</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-container">
      <view class="search-bar">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          placeholder="æœç´¢"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">
          <text>âœ•</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <scroll-view class="search-results" scroll-y="{{true}}" wx:if="{{isSearching}}">
      <view wx:if="{{searchResults.length === 0}}" class="empty-search">
        <text>æœªæ‰¾åˆ°ç›¸å…³å¤‡å¿˜å½•</text>
      </view>
      <view
        class="note-item"
        wx:for="{{searchResults}}"
        wx:key="id"
        bindtap="openNote"
        data-id="{{item.id}}"
      >
        <view class="note-info">
          <text class="note-title">{{item.title || 'æ–°å»ºå¤‡å¿˜å½•'}}</text>
          <view class="note-meta">
            <text class="note-time">{{item.updatedAtFormated}}</text>
            <text class="note-preview">{{item.shortContent}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- æ–‡ä»¶å¤¹åˆ—è¡¨ -->
    <scroll-view class="folder-list" scroll-y="{{true}}" wx:else>
      <!-- æœ¬åœ°å­˜å‚¨åŒºåŸŸ -->
      <view class="folder-section">
        <view class="section-header">
          <text class="section-title">æœ¬åœ°</text>
        </view>

        <!-- æ‰€æœ‰å¤‡å¿˜å½• -->
        <view
          class="folder-item"
          bindtap="enterFolder"
          data-id="all"
        >
          <view class="folder-icon-wrapper" style="background-color: #FFD60A">
            <text class="folder-icon">ğŸ“</text>
          </view>
          <view class="folder-info">
            <text class="folder-name">æ‰€æœ‰å¤‡å¿˜å½•</text>
          </view>
          <text class="folder-count">{{totalNotesCount}}</text>
          <text class="folder-arrow">â€º</text>
        </view>

        <!-- å…¶ä»–æ–‡ä»¶å¤¹ -->
        <view
          class="folder-item"
          wx:for="{{folders}}"
          wx:key="id"
          wx:if="{{item.id !== 'all'}}"
          bindtap="enterFolder"
          bindlongpress="onFolderLongPress"
          data-id="{{item.id}}"
        >
          <view class="folder-icon-wrapper" style="background-color: {{item.color}}">
            <text class="folder-icon">{{item.icon}}</text>
          </view>
          <view class="folder-info">
            <text class="folder-name">{{item.name}}</text>
          </view>
          <text class="folder-count">{{item.count || 0}}</text>
          <text class="folder-arrow">â€º</text>
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æ–°å»ºæŒ‰é’® -->
    <view class="bottom-bar" wx:if="{{!isSearching}}">
      <view class="new-note-btn" bindtap="createNote">
        <text class="new-note-icon">âœ</text>
      </view>
    </view>
  </view>

  <!-- å¤‡å¿˜å½•åˆ—è¡¨è§†å›¾ -->
  <view class="notes-view" wx:else>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="nav-bar">
      <view class="nav-left">
        <view class="back-btn" bindtap="backToFolders">
          <text class="back-icon">ğŸ”™</text>
          <text class="back-text">æ–‡ä»¶å¤¹</text>
        </view>
      </view>
      <view class="nav-right">
        <view class="edit-btn" bindtap="toggleEditMode">
          <text>{{isEditMode ? 'å®Œæˆ' : 'ç¼–è¾‘'}}</text>
        </view>
      </view>
    </view>

    <!-- æ–‡ä»¶å¤¹æ ‡é¢˜ -->
    <view class="folder-header">
      <text class="folder-title">{{currentFolder.name}}</text>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-container">
      <view class="search-bar">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          placeholder="æœç´¢"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">
          <text>âœ•</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <scroll-view class="notes-list" scroll-y="{{true}}" wx:if="{{isSearching}}">
      <view wx:if="{{searchResults.length === 0}}" class="empty-notes">
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å¤‡å¿˜å½•</text>
      </view>
      <view
        class="note-item"
        wx:for="{{searchResults}}"
        wx:key="id"
        bindtap="openNote"
        data-id="{{item.id}}"
      >
        <view class="note-checkbox" wx:if="{{isEditMode}}">
          <view class="checkbox {{selectedNotes.includes(item.id) ? 'checked' : ''}}">
            <text wx:if="{{selectedNotes.includes(item.id)}}">âœ“</text>
          </view>
        </view>
        <view class="note-info">
          <text class="note-title">{{item.title || 'æ–°å»ºå¤‡å¿˜å½•'}}</text>
          <view class="note-meta">
            <text class="note-time">{{item.updatedAtFormated}}</text>
            <text class="note-preview">{{item.shortContent}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- å¤‡å¿˜å½•åˆ—è¡¨ -->
    <scroll-view class="notes-list" scroll-y="{{true}}" wx:else>
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{displayNotes.length === 0}}" class="empty-notes">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æ²¡æœ‰å¤‡å¿˜å½•</text>
      </view>

      <!-- ç½®é¡¶å¤‡å¿˜å½• -->
      <view class="notes-section" wx:if="{{pinnedNotes.length > 0}}">
        <view class="section-header">
          <text class="section-label">å·²ç½®é¡¶</text>
        </view>
        <view
          class="note-item"
          wx:for="{{pinnedNotes}}"
          wx:key="id"
          bindtap="openNote"
          bindlongpress="onNoteLongPress"
          data-id="{{item.id}}"
        >
          <view class="note-checkbox" wx:if="{{isEditMode}}">
            <view class="checkbox {{selectedNotes.includes(item.id) ? 'checked' : ''}}">
              <text wx:if="{{selectedNotes.includes(item.id)}}">âœ“</text>
            </view>
          </view>
          <view class="note-info">
            <text class="note-title">{{item.title || 'æ–°å»ºå¤‡å¿˜å½•'}}</text>
            <view class="note-meta">
              <text class="note-time">{{item.updatedAtFormated}}</text>
              <text class="note-preview">{{item.shortContent}}</text>
            </view>
          </view>
          <view class="pin-indicator">
            <text>ğŸ“Œ</text>
          </view>
        </view>
      </view>

      <!-- æ™®é€šå¤‡å¿˜å½• -->
      <view class="notes-section" wx:if="{{unpinnedNotes.length > 0}}">
        <view class="section-header" wx:if="{{pinnedNotes.length > 0}}">
          <text class="section-label">å¤‡å¿˜å½•</text>
        </view>
        <view
          class="note-item"
          wx:for="{{unpinnedNotes}}"
          wx:key="id"
          bindtap="openNote"
          bindlongpress="onNoteLongPress"
          data-id="{{item.id}}"
        >
          <view class="note-checkbox" wx:if="{{isEditMode}}">
            <view class="checkbox {{selectedNotes.includes(item.id) ? 'checked' : ''}}">
              <text wx:if="{{selectedNotes.includes(item.id)}}">âœ“</text>
            </view>
          </view>
          <view class="note-info">
            <text class="note-title">{{item.title || 'æ–°å»ºå¤‡å¿˜å½•'}}</text>
            <view class="note-meta">
              <text class="note-time">{{item.updatedAtFormated}}</text>
              <text class="note-preview">{{item.shortContent}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <view class="bottom-bar">
      <view class="bottom-left" wx:if="{{isEditMode}}">
        <view class="action-btn" bindtap="toggleSelectAll">
          <text>{{selectedNotes.length === displayNotes.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
        </view>
      </view>
      <view class="bottom-left" wx:else>
        <text class="notes-count">{{displayNotes.length}} ä¸ªå¤‡å¿˜å½•</text>
      </view>

      <view class="bottom-center" wx:if="{{isEditMode && selectedNotes.length > 0}}">
        <view class="action-btn" bindtap="moveSelectedNotes">
          <text class="action-icon">ğŸ“</text>
        </view>
        <view class="action-btn delete" bindtap="deleteSelectedNotes">
          <text class="action-icon">ğŸ—‘ï¸</text>
        </view>
      </view>

      <view class="bottom-right">
        <view class="new-note-btn" bindtap="createNote">
          <text class="new-note-icon">âœ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–°å»ºæ–‡ä»¶å¤¹å¼¹çª— -->
  <view class="modal-mask {{showNewFolder ? 'visible' : ''}}" wx:if="{{showNewFolder}}" bindtap="hideNewFolderModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <view class="modal-cancel" bindtap="hideNewFolderModal">å–æ¶ˆ</view>
        <text class="modal-title">æ–°å»ºæ–‡ä»¶å¤¹</text>
        <view class="modal-confirm" bindtap="createNewFolder">å®Œæˆ</view>
      </view>
      <view class="modal-body">
        <view class="folder-preview">
          <view class="preview-icon-wrapper" style="background-color: {{newFolderColor}}">
            <text class="preview-icon">ğŸ“</text>
          </view>
        </view>
        <input
          class="folder-name-input"
          placeholder="åç§°"
          value="{{newFolderName}}"
          bindinput="onNewFolderNameInput"
          focus="{{showNewFolder}}"
        />
        <view class="color-picker">
          <view
            class="color-option {{newFolderColor === item ? 'active' : ''}}"
            wx:for="{{colorOptions}}"
            wx:key="*this"
            style="background-color: {{item}}"
            bindtap="selectFolderColor"
            data-color="{{item}}"
          >
            <text class="color-check" wx:if="{{newFolderColor === item}}">âœ“</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
