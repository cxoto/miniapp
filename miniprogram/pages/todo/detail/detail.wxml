<view class="detail-container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â€¹</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <view class="header-right">
      <view class="delete-btn" bindtap="deleteTask">åˆ é™¤</view>
    </view>
  </view>

  <scroll-view class="detail-content" scroll-y="true">
    <!-- ä»»åŠ¡ä¸»ä½“ -->
    <view class="task-main">
      <!-- å®ŒæˆçŠ¶æ€å’Œæ ‡é¢˜ -->
      <view class="task-header">
        <view class="task-checkbox" bindtap="toggleComplete">
          <view class="checkbox-circle {{task.completed ? 'completed' : ''}}">
            <text wx:if="{{task.completed}}">âœ“</text>
          </view>
        </view>
        <input
          class="task-title-input {{task.completed ? 'completed' : ''}}"
          value="{{task.title}}"
          bindinput="onTitleInput"
          bindblur="saveTask"
        />
        <view class="task-star {{task.important ? 'active' : ''}}" bindtap="toggleImportant">
          <text>{{task.important ? 'â˜…' : 'â˜†'}}</text>
        </view>
      </view>

      <!-- å­ä»»åŠ¡ -->
      <view class="section subtasks-section">
        <view class="subtask-list">
          <view
            class="subtask-item"
            wx:for="{{task.subtasks}}"
            wx:key="id"
          >
            <view class="subtask-checkbox" bindtap="toggleSubtask" data-id="{{item.id}}">
              <view class="checkbox-small {{item.completed ? 'completed' : ''}}">
                <text wx:if="{{item.completed}}">âœ“</text>
              </view>
            </view>
            <input
              class="subtask-title {{item.completed ? 'completed' : ''}}"
              value="{{item.title}}"
              bindinput="onSubtaskInput"
              data-id="{{item.id}}"
              bindblur="saveTask"
            />
            <view class="subtask-delete" bindtap="deleteSubtask" data-id="{{item.id}}">Ã—</view>
          </view>
        </view>
        <view class="add-subtask" bindtap="showAddSubtask">
          <text class="add-icon">+</text>
          <input
            wx:if="{{showSubtaskInput}}"
            class="subtask-input"
            placeholder="æ·»åŠ æ­¥éª¤"
            focus="{{showSubtaskInput}}"
            bindconfirm="addSubtask"
            bindblur="hideAddSubtask"
          />
          <text wx:else class="add-text">æ·»åŠ æ­¥éª¤</text>
        </view>
      </view>

      <!-- æ·»åŠ åˆ°"æˆ‘çš„ä¸€å¤©" -->
      <view class="section option-section" bindtap="toggleMyDay">
        <view class="option-icon {{task.myDay ? 'active' : ''}}">â˜€</view>
        <view class="option-content">
          <text class="option-text {{task.myDay ? 'active' : ''}}">
            {{task.myDay ? 'å·²æ·»åŠ åˆ°"æˆ‘çš„ä¸€å¤©"' : 'æ·»åŠ åˆ°"æˆ‘çš„ä¸€å¤©"'}}
          </text>
        </view>
        <view class="option-action" wx:if="{{task.myDay}}">
          <text class="remove-btn" catchtap="removeMyDay">Ã—</text>
        </view>
      </view>

      <!-- æé†’ -->
      <view class="section option-section" bindtap="showReminderPicker">
        <view class="option-icon">ğŸ””</view>
        <view class="option-content">
          <text class="option-text" wx:if="{{!task.reminder}}">æé†’æˆ‘</text>
          <view wx:else>
            <text class="option-text active">{{task.reminderStr}}</text>
          </view>
        </view>
        <view class="option-action" wx:if="{{task.reminder}}">
          <text class="remove-btn" catchtap="removeReminder">Ã—</text>
        </view>
      </view>

      <!-- æˆªæ­¢æ—¥æœŸ -->
      <view class="section option-section" bindtap="showDueDatePicker">
        <view class="option-icon {{task.isOverdue ? 'overdue' : ''}}">ğŸ“…</view>
        <view class="option-content">
          <text class="option-text" wx:if="{{!task.dueDate}}">æ·»åŠ æˆªæ­¢æ—¥æœŸ</text>
          <view wx:else>
            <text class="option-text {{task.isOverdue ? 'overdue' : 'active'}}">
              æˆªæ­¢äº {{task.dueDateStr}}
            </text>
          </view>
        </view>
        <view class="option-action" wx:if="{{task.dueDate}}">
          <text class="remove-btn" catchtap="removeDueDate">Ã—</text>
        </view>
      </view>

      <!-- é‡å¤ -->
      <view class="section option-section" bindtap="showRepeatPicker">
        <view class="option-icon">ğŸ”</view>
        <view class="option-content">
          <text class="option-text" wx:if="{{!task.repeat}}">é‡å¤</text>
          <text class="option-text active" wx:else>{{task.repeatStr}}</text>
        </view>
        <view class="option-action" wx:if="{{task.repeat}}">
          <text class="remove-btn" catchtap="removeRepeat">Ã—</text>
        </view>
      </view>

      <!-- åˆ†ç±»åˆ—è¡¨ -->
      <view class="section option-section" bindtap="showListPicker">
        <view class="option-icon" style="color: {{currentList.color || '#0078d4'}}">â˜°</view>
        <view class="option-content">
          <text class="option-text">{{currentList.name || 'ä»»åŠ¡'}}</text>
        </view>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="section note-section">
        <textarea
          class="note-input"
          placeholder="æ·»åŠ å¤‡æ³¨"
          value="{{task.note}}"
          bindinput="onNoteInput"
          bindblur="saveTask"
          auto-height
        />
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨ä¿¡æ¯ -->
  <view class="footer">
    <text class="created-info" wx:if="{{task.createdAt}}">
      åˆ›å»ºäº {{createdDateStr}}
    </text>
    <text class="completed-info" wx:if="{{task.completedAt}}">
      Â· å®Œæˆäº {{completedDateStr}}
    </text>
  </view>

  <!-- æ—¥æœŸé€‰æ‹©å™¨å¼¹çª— -->
  <view class="modal-mask {{showDatePicker ? 'visible' : ''}}" bindtap="hideDatePicker">
    <view class="picker-content" catchtap="preventBubble">
      <view class="picker-header">{{datePickerTitle}}</view>
      <view class="picker-shortcuts">
        <view class="picker-shortcut" bindtap="setDate" data-type="today">
          <text class="shortcut-icon">â˜€</text>
          <text class="shortcut-text">ä»Šå¤©</text>
          <text class="shortcut-date">{{todayStr}}</text>
        </view>
        <view class="picker-shortcut" bindtap="setDate" data-type="tomorrow">
          <text class="shortcut-icon">ğŸ“…</text>
          <text class="shortcut-text">æ˜å¤©</text>
          <text class="shortcut-date">{{tomorrowStr}}</text>
        </view>
        <view class="picker-shortcut" bindtap="setDate" data-type="nextweek">
          <text class="shortcut-icon">ğŸ“†</text>
          <text class="shortcut-text">ä¸‹å‘¨</text>
          <text class="shortcut-date">{{nextWeekStr}}</text>
        </view>
      </view>
      <picker mode="date" value="{{pickerDate}}" bindchange="onDatePickerChange">
        <view class="picker-custom">é€‰æ‹©å…·ä½“æ—¥æœŸ</view>
      </picker>
    </view>
  </view>

  <!-- åˆ—è¡¨é€‰æ‹©å™¨å¼¹çª— -->
  <view class="modal-mask {{showListSelector ? 'visible' : ''}}" bindtap="hideListPicker">
    <view class="picker-content" catchtap="preventBubble">
      <view class="picker-header">ç§»åŠ¨åˆ°åˆ—è¡¨</view>
      <scroll-view class="list-selector" scroll-y="true">
        <view
          class="list-option {{item.id === task.listId ? 'active' : ''}}"
          wx:for="{{allLists}}"
          wx:key="id"
          bindtap="selectList"
          data-id="{{item.id}}"
        >
          <view class="list-color" style="background-color: {{item.color}}"></view>
          <text class="list-name">{{item.name}}</text>
          <text class="list-check" wx:if="{{item.id === task.listId}}">âœ“</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- é‡å¤é€‰æ‹©å™¨å¼¹çª— -->
  <view class="modal-mask {{showRepeatSelector ? 'visible' : ''}}" bindtap="hideRepeatPicker">
    <view class="picker-content" catchtap="preventBubble">
      <view class="picker-header">é‡å¤</view>
      <view class="repeat-options">
        <view class="repeat-option" bindtap="setRepeat" data-type="daily">æ¯å¤©</view>
        <view class="repeat-option" bindtap="setRepeat" data-type="weekday">å·¥ä½œæ—¥</view>
        <view class="repeat-option" bindtap="setRepeat" data-type="weekly">æ¯å‘¨</view>
        <view class="repeat-option" bindtap="setRepeat" data-type="monthly">æ¯æœˆ</view>
        <view class="repeat-option" bindtap="setRepeat" data-type="yearly">æ¯å¹´</view>
      </view>
    </view>
  </view>
</view>
