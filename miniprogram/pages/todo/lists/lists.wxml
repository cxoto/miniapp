<view class="todo-container">
  <!-- å·¦ä¾§è¾¹æ  -->
  <view class="sidebar {{showSidebar ? 'visible' : ''}}">
    <view class="sidebar-header">
      <view class="user-info">
        <view class="avatar">
          <text>{{userInitial}}</text>
        </view>
        <view class="user-name">{{userName || 'æˆ‘çš„ä»»åŠ¡'}}</view>
      </view>
    </view>

    <scroll-view class="sidebar-content" scroll-y="true">
      <!-- æ™ºèƒ½åˆ—è¡¨ -->
      <view class="list-section">
        <view
          class="list-item {{currentListId === 'myday' ? 'active' : ''}}"
          bindtap="switchList"
          data-id="myday"
        >
          <view class="list-icon myday">â˜€</view>
          <text class="list-name">æˆ‘çš„ä¸€å¤©</text>
          <text class="list-count" wx:if="{{smartLists.myday > 0}}">{{smartLists.myday}}</text>
        </view>

        <view
          class="list-item {{currentListId === 'important' ? 'active' : ''}}"
          bindtap="switchList"
          data-id="important"
        >
          <view class="list-icon important">â˜…</view>
          <text class="list-name">é‡è¦</text>
          <text class="list-count" wx:if="{{smartLists.important > 0}}">{{smartLists.important}}</text>
        </view>

        <view
          class="list-item {{currentListId === 'planned' ? 'active' : ''}}"
          bindtap="switchList"
          data-id="planned"
        >
          <view class="list-icon planned">ğŸ“…</view>
          <text class="list-name">è®¡åˆ’å†…</text>
          <text class="list-count" wx:if="{{smartLists.planned > 0}}">{{smartLists.planned}}</text>
        </view>

        <view
          class="list-item {{currentListId === 'all' ? 'active' : ''}}"
          bindtap="switchList"
          data-id="all"
        >
          <view class="list-icon all">ğŸ“‹</view>
          <text class="list-name">å…¨éƒ¨</text>
          <text class="list-count" wx:if="{{smartLists.all > 0}}">{{smartLists.all}}</text>
        </view>
      </view>

      <view class="list-divider"></view>

      <!-- è‡ªå®šä¹‰åˆ—è¡¨ -->
      <view class="list-section">
        <view
          class="list-item {{currentListId === item.id ? 'active' : ''}}"
          wx:for="{{customLists}}"
          wx:key="id"
          bindtap="switchList"
          data-id="{{item.id}}"
          bindlongpress="showListOptions"
          data-list="{{item}}"
        >
          <view class="list-icon custom" style="color: {{item.color || '#4A90D9'}}">â˜°</view>
          <text class="list-name">{{item.name}}</text>
          <text class="list-count" wx:if="{{item.count > 0}}">{{item.count}}</text>
        </view>
      </view>

      <!-- æ–°å»ºåˆ—è¡¨ -->
      <view class="new-list-btn" bindtap="showNewListModal">
        <text class="new-list-icon">+</text>
        <text class="new-list-text">æ–°å»ºåˆ—è¡¨</text>
      </view>
    </scroll-view>
  </view>

  <!-- é®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
  <view class="sidebar-mask {{showSidebar ? 'visible' : ''}}" bindtap="toggleSidebar"></view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <view class="main-header" style="background-color: {{currentListColor}}">
      <view class="header-left">
        <view class="menu-btn" bindtap="toggleSidebar">â˜°</view>
        <view class="header-title">
          <text class="title-text">{{currentListName}}</text>
          <text class="title-date" wx:if="{{currentListId === 'myday'}}">{{todayDate}}</text>
        </view>
      </view>
      <view class="header-right">
        <view class="header-btn" bindtap="toggleSort">â‡…</view>
        <view class="header-btn" bindtap="showListSettings" wx:if="{{!isSmartList}}">â‹®</view>
      </view>
    </view>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <scroll-view class="task-list" scroll-y="true">
      <!-- æ·»åŠ ä»»åŠ¡è¾“å…¥æ¡† -->
      <view class="add-task-wrapper">
        <view class="add-task-box" bindtap="focusAddInput">
          <text class="add-icon">+</text>
          <input
            class="add-input"
            placeholder="æ·»åŠ ä»»åŠ¡"
            value="{{newTaskTitle}}"
            bindinput="onNewTaskInput"
            bindconfirm="addTask"
            confirm-type="done"
            focus="{{addInputFocus}}"
          />
        </view>
        <view class="quick-actions" wx:if="{{newTaskTitle}}">
          <view class="quick-btn {{newTaskMyDay ? 'active' : ''}}" bindtap="toggleNewTaskMyDay">
            <text>â˜€</text>
          </view>
          <view class="quick-btn" bindtap="showDatePicker">
            <text>ğŸ“…</text>
          </view>
        </view>
      </view>

      <!-- æœªå®Œæˆä»»åŠ¡ -->
      <view class="task-section">
        <view
          class="task-item"
          wx:for="{{incompleteTasks}}"
          wx:key="id"
          bindtap="openTaskDetail"
          data-id="{{item.id}}"
        >
          <view class="task-checkbox" catchtap="toggleTaskComplete" data-id="{{item.id}}">
            <view class="checkbox-circle {{item.completed ? 'completed' : ''}}">
              <text wx:if="{{item.completed}}">âœ“</text>
            </view>
          </view>
          <view class="task-content">
            <text class="task-title {{item.completed ? 'completed' : ''}}">{{item.title}}</text>
            <view class="task-meta">
              <text class="meta-item myday" wx:if="{{item.myDay}}">â˜€ æˆ‘çš„ä¸€å¤©</text>
              <text class="meta-item due {{item.isOverdue ? 'overdue' : ''}}" wx:if="{{item.dueDate}}">
                ğŸ“… {{item.dueDateStr}}
              </text>
              <text class="meta-item subtask" wx:if="{{item.subtasks && item.subtasks.length > 0}}">
                {{item.completedSubtasks || 0}}/{{item.subtasks.length}}
              </text>
            </view>
          </view>
          <view class="task-star {{item.important ? 'active' : ''}}" catchtap="toggleTaskImportant" data-id="{{item.id}}">
            <text>{{item.important ? 'â˜…' : 'â˜†'}}</text>
          </view>
        </view>
      </view>

      <!-- å·²å®Œæˆä»»åŠ¡ -->
      <view class="completed-section" wx:if="{{completedTasks.length > 0}}">
        <view class="section-header" bindtap="toggleCompletedSection">
          <text class="section-toggle">{{showCompleted ? 'â–¼' : 'â–¶'}}</text>
          <text class="section-title">å·²å®Œæˆ</text>
          <text class="section-count">{{completedTasks.length}}</text>
        </view>
        <view wx:if="{{showCompleted}}">
          <view
            class="task-item completed"
            wx:for="{{completedTasks}}"
            wx:key="id"
            bindtap="openTaskDetail"
            data-id="{{item.id}}"
          >
            <view class="task-checkbox" catchtap="toggleTaskComplete" data-id="{{item.id}}">
              <view class="checkbox-circle completed">
                <text>âœ“</text>
              </view>
            </view>
            <view class="task-content">
              <text class="task-title completed">{{item.title}}</text>
            </view>
            <view class="task-star {{item.important ? 'active' : ''}}" catchtap="toggleTaskImportant" data-id="{{item.id}}">
              <text>{{item.important ? 'â˜…' : 'â˜†'}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{incompleteTasks.length === 0 && completedTasks.length === 0}}">
        <view class="empty-icon">{{emptyIcon}}</view>
        <text class="empty-text">{{emptyText}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- æ–°å»ºåˆ—è¡¨å¼¹çª— -->
  <view class="modal-mask {{showNewList ? 'visible' : ''}}" bindtap="hideNewListModal" wx:if="{{showNewList}}">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text class="modal-title">æ–°å»ºåˆ—è¡¨</text>
      </view>
      <view class="modal-body">
        <input
          class="list-name-input"
          placeholder="è¾“å…¥åˆ—è¡¨åç§°"
          value="{{newListName}}"
          bindinput="onNewListNameInput"
          focus="{{newListInputFocus}}"
        />
        <view class="color-picker">
          <view
            class="color-option {{newListColor === item ? 'active' : ''}}"
            wx:for="{{colorOptions}}"
            wx:key="*this"
            style="background-color: {{item}}"
            bindtap="selectListColor"
            data-color="{{item}}"
          ></view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="hideNewListModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="createNewList">åˆ›å»º</view>
      </view>
    </view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="modal-mask {{showDatePickerModal ? 'visible' : ''}}" bindtap="hideDatePicker" wx:if="{{showDatePickerModal}}">
    <view class="date-picker-content" catchtap="preventBubble">
      <view class="date-header">é€‰æ‹©æ—¥æœŸ</view>
      <view class="date-shortcuts">
        <view class="date-shortcut" bindtap="setDueDate" data-type="today">
          <text class="shortcut-icon">â˜€</text>
          <text>ä»Šå¤©</text>
        </view>
        <view class="date-shortcut" bindtap="setDueDate" data-type="tomorrow">
          <text class="shortcut-icon">ğŸ“…</text>
          <text>æ˜å¤©</text>
        </view>
        <view class="date-shortcut" bindtap="setDueDate" data-type="nextweek">
          <text class="shortcut-icon">ğŸ“†</text>
          <text>ä¸‹å‘¨</text>
        </view>
      </view>
      <picker mode="date" value="{{pickerDate}}" bindchange="onDateChange">
        <view class="date-custom">é€‰æ‹©å…·ä½“æ—¥æœŸ</view>
      </picker>
    </view>
  </view>
</view>
